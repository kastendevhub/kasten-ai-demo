kind: Blueprint
apiVersion: cr.kanister.io/v1alpha1
metadata:
  name: qdrant-hooks
  namespace: kasten-io
actions:
  backupPosthook:
    name: ""
    kind: ""
    phases:
      - func: KubeTask
        name: unlockQdrant
        args:
          command:
            - sh
            - -c
            - |
              curl --location 'http://qdrant:6333/locks' \
              --header 'Content-Type: application/json' \
              --data '{
                  "write": false
              }'
          image: curlimages/curl
          namespace: "{{ .StatefulSet.Namespace }}"
  backupPrehook:
    name: ""
    kind: ""
    phases:
      - func: KubeTask
        name: lockQdrant
        args:
          command:
            - sh
            - -c
            - >
              curl --location 'http://qdrant:6333/locks' \

              --header 'Content-Type: application/json' \

              --data '{
                  "error_message": "write is temporarily disabled while a Kasten backup is performed",
                  "write": true
              }'
          image: curlimages/curl
          namespace: "{{ .StatefulSet.Namespace }}"
